<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nim实用技巧集锦</title>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<!-- JS -->
<script type="text/javascript" src="dochack.js"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">Nim实用技巧集锦</h1>
      <blockquote class="markdown-quote"><p>
<h6 id="更多nim教程和技巧-可以关注colon- -「mydotoschinadotnetslashanglucahttpcolonslashslashmydotoschinadotnetslashangluca」">更多nim教程和技巧, 可以关注:)  「<a class="reference external" href="http://www.angluca.com">www.angluca.com</a>」</h6>
<h6 id="函数名的使用">函数名的使用</h6></p></blockquote>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">my_func</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span><span class="Identifier">int</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span>
  <span class="Keyword">return</span> <span class="Identifier">a</span> <span class="Operator">+</span> <span class="DecNumber">100</span>

<span class="Identifier">echo</span> <span class="Identifier">m_y_f_UN_C</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">myFunc</span><span class="Punctuation">(</span><span class="DecNumber">2</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">myfunc</span><span class="Punctuation">(</span><span class="DecNumber">3</span><span class="Punctuation">)</span></pre></p>
<p>上面的代码编译是正确的. 原来函数名是忽略大小写和下划线的, 所以爱怎么用函数名就怎么用吧, 峰驼和下划线党不会起冲突了. (注意: nim里名对首字母大小写敏感, 而且首字不能用下划线.)</p>

<h6 id="使用函数可以不用discard">使用函数可以不用discard</h6><p>使用pragma: discardable 的函数可以直接使用了.</p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">test</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">discardable</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">return</span> <span class="DecNumber">9</span>

<span class="Identifier">test</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Comment">#discard test() #如果没有discardable需这样写.</span></pre></p>

<h6 id="数组的使用-nim的数组比c语言的要强大-可以不从0开始-也可以是单字母-虽然都一样colon">数组的使用 nim的数组比c语言的要强大, 可以不从0开始, 也可以是单字母(虽然都一样:)</h6><p><pre class="listing">
<span class="Keyword">var</span> <span class="Identifier">int_array</span> <span class="Punctuation">:</span> <span class="Identifier">array</span><span class="Punctuation">[</span><span class="FloatNumber">42.</span><span class="Operator">.</span><span class="DecNumber">44</span><span class="Punctuation">,</span> <span class="Identifier">int</span><span class="Punctuation">]</span>
<span class="Identifier">int_array</span><span class="Punctuation">[</span><span class="DecNumber">43</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="DecNumber">100</span>
<span class="Comment"># int_array[45] = 1 #错误 超过定义的范围了</span>
<span class="Identifier">echo</span> <span class="Identifier">int_array</span><span class="Punctuation">[</span><span class="DecNumber">42</span><span class="Punctuation">]</span> <span class="Comment">#0</span>
<span class="Identifier">echo</span> <span class="Identifier">int_array</span><span class="Punctuation">[</span><span class="DecNumber">43</span><span class="Punctuation">]</span> <span class="Comment">#100</span>
<span class="Identifier">int_array</span> <span class="Operator">=</span> <span class="Punctuation">[</span><span class="DecNumber">12</span><span class="Punctuation">,</span><span class="DecNumber">42</span><span class="Punctuation">,</span><span class="DecNumber">66</span><span class="Punctuation">]</span> <span class="Comment">#同样也可以这样赋值</span>
<span class="Keyword">for</span> <span class="Identifier">i</span><span class="Punctuation">,</span><span class="Identifier">v</span> <span class="Keyword">in</span> <span class="Identifier">int_array</span><span class="Punctuation">:</span>
  <span class="Identifier">echo</span> <span class="Identifier">i</span><span class="Punctuation">,</span> <span class="StringLit">&quot;=&quot;</span><span class="Punctuation">,</span> <span class="Identifier">v</span> <span class="Comment">#i是索引, v是值</span>
<span class="Comment">#结果</span>
<span class="Comment">#42=12</span>
<span class="Comment">#43=13</span>
<span class="Comment">#44=14</span>
<span class="Keyword">var</span> <span class="Identifier">ch_array</span> <span class="Punctuation">:</span> <span class="Identifier">array</span><span class="Punctuation">[</span><span class="CharLit">'A'</span><span class="Operator">..</span><span class="CharLit">'z'</span><span class="Punctuation">,</span> <span class="Identifier">int</span><span class="Punctuation">]</span> <span class="Comment">#从A-Z-a-z</span>
<span class="Identifier">ch_array</span><span class="Punctuation">[</span><span class="CharLit">'a'</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="DecNumber">111</span>
<span class="Identifier">echo</span> <span class="Identifier">ch_array</span><span class="Punctuation">[</span><span class="CharLit">'a'</span><span class="Punctuation">]</span> <span class="Comment">#111</span></pre> ###### 枚举值的查找 nim可以直接用字符串得到枚举值, 省掉不少麻烦.</p>
<p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">strutils</span>
<span class="Keyword">type</span> <span class="Identifier">MyEnum</span> <span class="Operator">=</span> <span class="Keyword">enum</span> <span class="Identifier">enA</span><span class="Punctuation">,</span> <span class="Identifier">enB</span><span class="Punctuation">,</span> <span class="Identifier">enC</span><span class="Punctuation">,</span> <span class="Identifier">enuD</span><span class="Punctuation">,</span> <span class="Identifier">enE</span>
<span class="Identifier">doAssert</span> <span class="Identifier">parseEnum</span><span class="Punctuation">[</span><span class="Identifier">MyEnum</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="StringLit">&quot;enu_D&quot;</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">enuD</span> <span class="Comment">#还记得使用函数可名不分下划线和大小写么.</span>
<span class="Identifier">doAssert</span> <span class="Identifier">MyEnum</span><span class="Punctuation">(</span><span class="DecNumber">0</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">enA</span>
<span class="Identifier">doAssert</span> <span class="Identifier">enA</span><span class="Operator">.</span><span class="Identifier">ord</span> <span class="Operator">==</span> <span class="DecNumber">0</span>
<span class="Identifier">doAssert</span> <span class="Operator">$</span><span class="Identifier">enA</span> <span class="Operator">==</span> <span class="StringLit">&quot;enA&quot;</span></pre> ###### enum的复杂使用 很多时候可以简化功能的实现方法.</p>
<p><pre class="listing">
<span class="Keyword">type</span>
    <span class="Identifier">MyEnum</span> <span class="Operator">=</span> <span class="Keyword">enum</span>
        <span class="Identifier">valueA</span> <span class="Operator">=</span> <span class="Punctuation">(</span><span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="StringLit">&quot;my value A&quot;</span><span class="Punctuation">)</span><span class="Punctuation">,</span>
        <span class="Identifier">valueB</span> <span class="Operator">=</span> <span class="StringLit">&quot;value B&quot;</span><span class="Punctuation">,</span>
        <span class="Identifier">valueC</span> <span class="Operator">=</span> <span class="DecNumber">2</span><span class="Punctuation">,</span>
        <span class="Identifier">valueD</span> <span class="Operator">=</span> <span class="Punctuation">(</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="StringLit">&quot;abc&quot;</span><span class="Punctuation">)</span>

<span class="Identifier">echo</span> <span class="Identifier">ord</span><span class="Punctuation">(</span><span class="Identifier">valueA</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">ord</span><span class="Punctuation">(</span><span class="Identifier">valueB</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">ord</span><span class="Punctuation">(</span><span class="Identifier">valueC</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">ord</span><span class="Punctuation">(</span><span class="Identifier">valued</span><span class="Punctuation">)</span>

<span class="Identifier">echo</span> <span class="Punctuation">(</span><span class="Identifier">valueA</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Punctuation">(</span><span class="Identifier">valueB</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Punctuation">(</span><span class="Identifier">valueC</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Punctuation">(</span><span class="Identifier">valued</span><span class="Punctuation">)</span></pre></p>
<p>显示结果</p>
<p><pre class="listing">
0
1
2
3
my value A
value B
valueC
abc</pre></p>

<h6 id="对象的多态性-这是其它语言都有的功能-大家刚用nim也许不知道怎么用-所以写在这里方便大家学习使用dot">对象的多态性 这是其它语言都有的功能, 大家刚用nim也许不知道怎么用, 所以写在这里方便大家学习使用.</h6><p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">ObjA</span> <span class="Operator">=</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">RootObj</span>
  <span class="Identifier">ObjB</span> <span class="Operator">=</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">ObjA</span>
  <span class="Identifier">ObjC</span> <span class="Operator">=</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">ObjB</span>

<span class="Keyword">method</span> <span class="Identifier">pt</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">:</span><span class="Identifier">ObjA</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;A&quot;</span>
<span class="Keyword">method</span> <span class="Identifier">pt</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">:</span><span class="Identifier">ObjB</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;B&quot;</span>
<span class="Keyword">method</span> <span class="Identifier">pt</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">:</span><span class="Identifier">ObjC</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;C&quot;</span>

<span class="Keyword">proc</span> <span class="Identifier">testObj</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">:</span><span class="Identifier">ObjA</span><span class="Punctuation">)</span><span class="Operator">=</span>
  <span class="Identifier">obj</span><span class="Operator">.</span><span class="Identifier">pt</span>
<span class="Keyword">var</span>
  <span class="Identifier">a</span> <span class="Operator">=</span> <span class="Identifier">ObjA</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Identifier">b</span> <span class="Operator">=</span> <span class="Identifier">ObjB</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Identifier">c</span> <span class="Operator">=</span> <span class="Identifier">ObjC</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Identifier">a</span><span class="Operator">.</span><span class="Identifier">testObj</span>
<span class="Identifier">b</span><span class="Operator">.</span><span class="Identifier">testObj</span>
<span class="Identifier">c</span><span class="Operator">.</span><span class="Identifier">testObj</span>

<span class="Comment">#结果</span>
<span class="Comment">#A</span>
<span class="Comment">#B</span>
<span class="Comment">#C</span></pre></p>

<h6 id="函数参数的应用-函数形参加var是可修改-不加就是不可改dot-类似cplusplus的引用">函数参数的应用 函数形参加var是可修改, 不加就是不可改. (类似c++的引用)</h6><p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">test</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span><span class="Identifier">int</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span><span class="Keyword">var</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Comment">#a为不可改, b为可修改参数</span>
   <span class="Identifier">a</span> <span class="Operator">+=</span> <span class="DecNumber">1</span> <span class="Comment">#错误! a是不可改的</span>
   <span class="Identifier">b</span> <span class="Operator">+=</span> <span class="DecNumber">1</span> <span class="Comment">#正确</span></pre></p>

<h6 id="模块名的应用-强制用户包含模块名使用其中内容">模块名的应用 强制用户包含模块名使用其中内容</h6><p><pre class="listing">
<span class="Keyword">from</span> <span class="Identifier">os</span> <span class="Keyword">import</span> <span class="Keyword">nil</span>
<span class="Identifier">echo</span> <span class="Identifier">os</span><span class="Operator">.</span><span class="Identifier">isHidden</span><span class="Punctuation">(</span><span class="StringLit">&quot;~/&quot;</span><span class="Punctuation">)</span> <span class="Comment">#正常</span>
<span class="Identifier">echo</span> <span class="Identifier">isHidden</span><span class="Punctuation">(</span><span class="StringLit">&quot;~/&quot;</span><span class="Punctuation">)</span> <span class="Comment">#错误, 必须加os模块名</span></pre></p>

<h6 id="字符串转数字-字符串转化为各种变量-还有更多的转化变量函数可以去strutilsdotnim里查看-而数字转字符串只需变量前加dollardot">字符串转数字 字符串转化为各种变量, 还有更多的转化变量函数可以去strutils.nim里查看, 而数字转字符串只需变量前加$.</h6><p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">strutils</span>
<span class="Keyword">var</span> <span class="Identifier">num</span> <span class="Operator">=</span> <span class="Identifier">parseInt</span><span class="Punctuation">(</span><span class="StringLit">&quot;123&quot;</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">fnum</span> <span class="Operator">=</span> <span class="Identifier">parseFloat</span><span class="Punctuation">(</span><span class="StringLit">&quot;5.23&quot;</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">num</span>
<span class="Identifier">echo</span> <span class="Identifier">fnum</span>

<span class="Comment">#123</span>
<span class="Comment">#5.23</span></pre></p>

<h6 id="cstring和string相互转换">cstring和string相互转换</h6><p><pre class="listing">
<span class="Keyword">var</span> <span class="Identifier">str</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span> <span class="StringLit">&quot;Hello!&quot;</span>
<span class="Keyword">var</span> <span class="Identifier">cstr</span><span class="Punctuation">:</span> <span class="Identifier">cstring</span> <span class="Operator">=</span> <span class="Identifier">str</span>
<span class="Keyword">var</span> <span class="Identifier">newstr</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span> <span class="Operator">$</span><span class="Identifier">cstr</span></pre> string是可以直接转为cstring使用, 而cstring转string则需要加上$符号.</p>

<h6 id="巧用seq转cstring-有时候想把数组当字符串用qmark-教你简单又粗暴的方法dot">巧用seq转cstring 有时候想把数组当字符串用? 教你简单又粗暴的方法.</h6><p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">typetraits</span>
<span class="Keyword">var</span> <span class="Identifier">sequ</span> <span class="Operator">=</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'h'</span><span class="Punctuation">,</span> <span class="CharLit">'e'</span><span class="Punctuation">,</span> <span class="CharLit">'l'</span><span class="Punctuation">,</span> <span class="CharLit">'l'</span><span class="Punctuation">,</span> <span class="CharLit">'o'</span><span class="Punctuation">]</span>
<span class="Identifier">sequ</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="CharLit">'!'</span><span class="Punctuation">)</span>

<span class="Identifier">echo</span> <span class="Identifier">sequ</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Operator">.</span><span class="Identifier">name</span>
<span class="Identifier">echo</span> <span class="Identifier">sequ</span>

<span class="Keyword">let</span> <span class="Identifier">str</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Identifier">cstring</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Keyword">addr</span><span class="Punctuation">(</span><span class="Identifier">sequ</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Operator">.</span><span class="Identifier">name</span>
<span class="Identifier">echo</span> <span class="Identifier">str</span>

<span class="Comment">#seq[char]</span>
<span class="Comment">#@[h, e, l, l, o, !]</span>
<span class="Comment">#cstring</span>
<span class="Comment">#hello!</span></pre></p>

<h6 id="对象类型的判断">对象类型的判断</h6><p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">typetraits</span>
<span class="Keyword">type</span>
    <span class="Identifier">Person</span> <span class="Operator">=</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">RootObj</span>
        <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span>   <span class="Comment"># * 表示能在其它模块里使用, 公有</span>
        <span class="Identifier">age</span><span class="Punctuation">:</span> <span class="Identifier">int</span>        <span class="Comment"># 只能本文件用, 私有</span>
    <span class="Identifier">Student</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Person</span>
        <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="Identifier">int</span>
<span class="Keyword">var</span>
    <span class="Identifier">student</span><span class="Punctuation">:</span> <span class="Identifier">Student</span>
    <span class="Identifier">person</span><span class="Punctuation">:</span> <span class="Identifier">Person</span>
<span class="Identifier">assert</span><span class="Punctuation">(</span><span class="Identifier">student</span> <span class="Keyword">of</span> <span class="Identifier">Student</span><span class="Punctuation">)</span>  <span class="Comment"># of 值为 true, is 也可以</span>
<span class="Identifier">assert</span><span class="Punctuation">(</span><span class="Identifier">student</span> <span class="Keyword">of</span> <span class="Identifier">Person</span><span class="Punctuation">)</span>   <span class="Comment"># of 可以判断继承类型所以为 true, is 则类型必须相同所以为false.</span>
<span class="Identifier">echo</span> <span class="Identifier">student</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Operator">.</span><span class="Identifier">name</span> <span class="Comment"># 名为&quot;Student&quot;</span>

<span class="Keyword">var</span> <span class="Identifier">str</span> <span class="Operator">=</span> <span class="StringLit">&quot;test&quot;</span>
<span class="Identifier">assert</span><span class="Punctuation">(</span><span class="Identifier">str</span> <span class="Keyword">is</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Comment">#值为 true</span></pre></p>
<p>of可以判断是否为继承类, is只能判断是否为当前类型.</p>

<h6 id="手动释放非追踪对象-特别注意colon-如果一个非追踪对象包含了追踪对象-比如追踪引用、字符串或者序列-为了正确地释放每一块内存-在手动释放非追踪内存前必须调用-gc-unref">手动释放非追踪对象 特别注意: 如果一个非追踪对象包含了追踪对象(比如追踪引用、字符串或者序列),为了正确地释放每一块内存,在手动释放非追踪内存前必须调用 GC_unref()</h6><p><pre class="listing">
<span class="Keyword">type</span>
    <span class="Identifier">Data</span> <span class="Operator">=</span> <span class="Keyword">tuple</span><span class="Punctuation">[</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">]</span>
<span class="Comment"># 为 Data 在堆上分配内存</span>
<span class="Keyword">var</span> <span class="Identifier">d</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Keyword">ptr</span> <span class="Identifier">Data</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">alloc0</span><span class="Punctuation">(</span><span class="Identifier">sizeof</span><span class="Punctuation">(</span><span class="Identifier">Data</span><span class="Punctuation">)</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Comment"># 通过 GC 在堆上创建一个新的字符串</span>
<span class="Identifier">d</span><span class="Operator">.</span><span class="Identifier">s</span> <span class="Operator">=</span> <span class="StringLit">&quot;abc&quot;</span>
<span class="Comment"># 告诉 GC 该字符串不再需要</span>
<span class="Identifier">GC_unref</span><span class="Punctuation">(</span><span class="Identifier">d</span><span class="Operator">.</span><span class="Identifier">s</span><span class="Punctuation">)</span>
<span class="Comment"># 释放内存</span>
<span class="Identifier">dealloc</span><span class="Punctuation">(</span><span class="Identifier">d</span><span class="Punctuation">)</span></pre></p>
<p>如果在 dealloc(d) 之前没有调用 GC_unref(d.s), 那么这个字符串内存永远不会释放. 上面的例子也给出了底层编程的两个重要特点: sizeof() 函数返回一个类型的字节大小, cast[] 可以使编译器强制把内存用某个特定类型表示, 只有必要的情况下使用 cast[], 它破坏类型安全且容易滋生 bug.</p>
<p>注意: 上面的例子可以工作是因为其内存已经通过 alloc0() 初始化为 0, 也因此 d.s 被初始化为 nil 并且可以对其赋值.</p>

<h6 id="禁止类型对象使用nil值-所有的值可以是-nil-的类型-可以通过-not-nil-声明为禁止使用-nil-值dot">禁止类型对象使用nil值 所有的值可以是 nil 的类型, 可以通过 not nil 声明为禁止使用 nil 值.</h6><p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">PObject</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Identifier">TObj</span> <span class="Keyword">not</span> <span class="Keyword">nil</span>
  <span class="Identifier">TProc</span> <span class="Operator">=</span> <span class="Punctuation">(</span><span class="Keyword">proc</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span><span class="Punctuation">)</span> <span class="Keyword">not</span> <span class="Keyword">nil</span>

<span class="Keyword">proc</span> <span class="Identifier">p</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">PObject</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;not nil&quot;</span>

<span class="Identifier">p</span><span class="Punctuation">(</span><span class="Keyword">nil</span><span class="Punctuation">)</span> <span class="Comment"># 这里提示异常</span>

<span class="Keyword">var</span> <span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">PObject</span>
<span class="Identifier">p</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span> <span class="Comment"># 这里也是</span>

<span class="Keyword">var</span> <span class="Identifier">str</span><span class="Punctuation">:</span><span class="Identifier">string</span> <span class="Keyword">not</span> <span class="Keyword">nil</span> <span class="Operator">=</span> <span class="Keyword">nil</span> <span class="Comment"># 这还是</span></pre></p>

<h6 id="内存区域划分-ref-类型和-ptr-类型可以获得一个可选的区域标注-使用区域标注必须是个对象类型dot">内存区域划分 ref 类型和 ptr 类型可以获得一个可选的区域标注, 使用区域标注必须是个对象类型.</h6><p>在开发操作系统内核时,划分用户空间和内核空间是非常有用的.</p>
<p><pre class="listing">
<span class="Keyword">type</span>
    <span class="Identifier">Kernel</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Identifier">Userspace</span> <span class="Operator">=</span> <span class="Keyword">object</span>
<span class="Keyword">var</span> <span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">Kernel</span> <span class="Keyword">ptr</span> <span class="Identifier">Stat</span>
<span class="Keyword">var</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">Userspace</span> <span class="Keyword">ptr</span> <span class="Identifier">Stat</span>
<span class="Comment"># 下面的内容不能编译,因为指针类型不兼容.</span>
<span class="Identifier">a</span> <span class="Operator">=</span> <span class="Identifier">b</span></pre> 如例子所示,ptr 也能用做二元操作符,region ptr T 是 ptr[region, T] 的简写. 为了简化泛型编码,ptr T 表示 ptr[R, T] (任意 R) 的派生子类. 作为特殊的类型规则,ptr[R, T] 不兼容 pointer.</p>
<p><pre class="listing">
<span class="Comment"># from system</span>
<span class="Keyword">proc</span> <span class="Identifier">dealloc</span><span class="Punctuation">(</span><span class="Identifier">p</span><span class="Punctuation">:</span> <span class="Identifier">pointer</span><span class="Punctuation">)</span>
<span class="Comment"># wrap some scripting language</span>
<span class="Keyword">type</span>
    <span class="Identifier">PythonsHeap</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Identifier">PyObjectHeader</span> <span class="Operator">=</span> <span class="Keyword">object</span>
        <span class="Identifier">rc</span><span class="Punctuation">:</span> <span class="Identifier">int</span>
        <span class="Identifier">typ</span><span class="Punctuation">:</span> <span class="Identifier">pointer</span>
    <span class="Identifier">PyObject</span> <span class="Operator">=</span> <span class="Keyword">ptr</span><span class="Punctuation">[</span><span class="Identifier">PythonsHeap</span><span class="Punctuation">,</span> <span class="Identifier">PyObjectHeader</span><span class="Punctuation">]</span>

<span class="Keyword">proc</span> <span class="Identifier">createPyObject</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">PyObject</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">importc</span><span class="Punctuation">:</span> <span class="StringLit">&quot;...&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span>
<span class="Keyword">proc</span> <span class="Identifier">destroyPyObject</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">PyObject</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">importc</span><span class="Punctuation">:</span> <span class="StringLit">&quot;...&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span>

<span class="Keyword">var</span> <span class="Identifier">foo</span> <span class="Operator">=</span> <span class="Identifier">createPyObject</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Comment"># type error here, how convenient:</span>
<span class="Identifier">dealloc</span><span class="Punctuation">(</span><span class="Identifier">foo</span><span class="Punctuation">)</span></pre> 未来方向: 内存区域也可以对 string 和 seq 有效 内置区域比如 private global local 在即将到来的 OpenCL 会更有用 内置区域可以构造 lent 和 unique 指针 赋值操作符可以附加到区域,以生成合适的写屏障.这意味着 GC 可以彻底在用户空间实现. ###### 函数类型的约定 函数类型是一个指向函数地址的指针。允许把 nil 作为一个函数的值。Nim 语言运用函数类型来达成函数式编程语言的技巧。</p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">printItem</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Operator">...</span>
<span class="Keyword">proc</span> <span class="Identifier">forEach</span><span class="Punctuation">(</span><span class="Identifier">c</span><span class="Punctuation">:</span> <span class="Keyword">proc</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">cdecl</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">)</span> <span class="Operator">=...</span>
<span class="Identifier">forEach</span><span class="Punctuation">(</span><span class="Identifier">printItem</span><span class="Punctuation">)</span>  <span class="Comment"># 不能编译，因为调用约定不同</span></pre></p>
<p><pre class="listing">
<span class="Keyword">type</span>
    <span class="Identifier">OnMouseMove</span> <span class="Operator">=</span> <span class="Keyword">proc</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">closure</span><span class="Operator">.</span><span class="Punctuation">}</span>
<span class="Keyword">proc</span> <span class="Identifier">onMouseMove</span><span class="Punctuation">(</span><span class="Identifier">mouseX</span><span class="Punctuation">,</span> <span class="Identifier">mouseY</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span>
    <span class="Comment"># 使用默认的调用约定</span>
    <span class="Identifier">echo</span> <span class="StringLit">&quot;x: &quot;</span><span class="Punctuation">,</span> <span class="Identifier">mouseX</span><span class="Punctuation">,</span> <span class="StringLit">&quot; y: &quot;</span><span class="Punctuation">,</span> <span class="Identifier">mouseY</span>
<span class="Keyword">proc</span> <span class="Identifier">setOnMouseMove</span><span class="Punctuation">(</span><span class="Identifier">mouseMoveEvent</span><span class="Punctuation">:</span> <span class="Identifier">OnMouseMove</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">discard</span>
<span class="Comment"># ok，onMouseMove 使用默认的调用约定，该约定兼容  {.closure.}</span>
<span class="Identifier">setOnMouseMove</span><span class="Punctuation">(</span><span class="Identifier">onMouseMove</span><span class="Punctuation">)</span></pre></p>
<p>一个极其微妙的细节是，函数的调用约定会影响类型的兼容：拥有相同调用约定的函数类型才能够彼此兼容。作为一个特殊的扩展，一个使用 {.nimcall.} 调用约定的函数，可以作为参数传递给一个期望调用约定是 {.closure.} 的函数参数。</p>

<h6 id="用type使用对象类型-type-操作符用来获取一个表达式的类型（同-c-语言的-typeof）：">用type使用对象类型 type 操作符用来获取一个表达式的类型（同 C 语言的 typeof）：</h6><p><pre class="listing">
<span class="Keyword">var</span> <span class="Identifier">x</span> <span class="Operator">=</span> <span class="DecNumber">0</span>
<span class="Keyword">var</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Keyword">type</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span> <span class="Comment"># y has type int</span></pre></p>
<p>type 也可以用来确定一个 proc/iterator/converter 调用 c(X) 的结果类型:</p>
<p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">strutils</span>

<span class="Comment"># strutils contains both a ``split`` proc and iterator, but since an</span>
<span class="Comment"># an iterator is the preferred interpretation, `y` has the type ``string``:</span>
<span class="Keyword">var</span> <span class="Identifier">y</span> <span class="Punctuation">:</span> <span class="Keyword">type</span><span class="Punctuation">(</span><span class="StringLit">&quot;a b c&quot;</span><span class="Operator">.</span><span class="Identifier">split</span><span class="Punctuation">)</span></pre></p>

<h6 id="局部变量当全局变量使用-类似cslashcplusplus的static-生存周期变成全局-初始化也只会执行一次-方便测试功能">局部变量当全局变量使用 类似c/c++的static, 生存周期变成全局, 初始化也只会执行一次, 方便测试功能</h6><p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">getInt</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Keyword">ptr</span> <span class="Identifier">int</span><span class="Operator">=</span>
   <span class="Keyword">var</span> <span class="Identifier">inst</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">global</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Keyword">ptr</span> <span class="Identifier">int</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">alloc</span><span class="Punctuation">(</span><span class="DecNumber">4</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
   <span class="Identifier">inst</span><span class="Punctuation">[</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="DecNumber">100</span>
   <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">inst</span>

<span class="Identifier">echo</span> <span class="Identifier">repr</span> <span class="Identifier">getInt</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">repr</span> <span class="Identifier">getInt</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre></p>

<h6 id="简易使用任意数组和seq当函数参数">简易使用任意数组和seq当函数参数</h6><p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">test</span><span class="Punctuation">(</span><span class="Identifier">v</span><span class="Punctuation">:</span> <span class="Identifier">array</span> <span class="Keyword">or</span> <span class="Identifier">seq</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Comment">#或者 array|seq</span>
  <span class="Identifier">echo</span> <span class="Identifier">repr</span> <span class="Identifier">v</span>
  <span class="Keyword">return</span>

<span class="Keyword">var</span> <span class="Identifier">sz</span><span class="Punctuation">:</span><span class="Identifier">array</span><span class="Punctuation">[</span><span class="DecNumber">9999999</span><span class="Punctuation">,</span> <span class="Identifier">int32</span><span class="Punctuation">]</span>
<span class="Keyword">var</span> <span class="Identifier">sq</span><span class="Punctuation">:</span><span class="Identifier">seq</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span>
<span class="Identifier">test</span><span class="Punctuation">(</span><span class="Identifier">sz</span><span class="Punctuation">)</span>
<span class="Identifier">test</span><span class="Punctuation">(</span><span class="Identifier">sq</span><span class="Punctuation">)</span></pre> 用这种方法可以直接使用array或seq而不用定义变量类型了哦(当然也可以使用auto).</p>
<p><pre class="listing">
type class      matches

object          any object type
tuple           any tuple type
enum            any enumeration
proc            any proc type
ref             any ref type
ptr             any ptr type
var             any var type
distinct        any distinct type
array           any array type
set             any set type
seq             any seq type
auto            any type</pre> 需要两个以上类型合并才能使用这个方法, 其它类型也可以, 具体还得自己去体验.</p>

<h6 id="defer延迟操作-把前面打上defer的语句推迟到当前块最后操作-多defer越前的越后执行-defer内顺序执行-可以替代的try-finallydot">defer延迟操作 把前面打上defer的语句推迟到当前块最后操作, 多defer越前的越后执行, defer内顺序执行, 可以替代的try,finally.</h6><p><pre class="listing">
<span class="Keyword">var</span> <span class="Identifier">f</span> <span class="Operator">=</span> <span class="Identifier">open</span><span class="Punctuation">(</span><span class="StringLit">&quot;numbers.txt&quot;</span><span class="Punctuation">)</span>
<span class="Keyword">defer</span><span class="Punctuation">:</span> <span class="Identifier">close</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">)</span>
<span class="Identifier">f</span><span class="Operator">.</span><span class="Identifier">write</span> <span class="StringLit">&quot;abc&quot;</span>
<span class="Identifier">f</span><span class="Operator">.</span><span class="Identifier">write</span> <span class="StringLit">&quot;def&quot;</span></pre></p>
<p>类似这个效果</p>
<p><pre class="listing">
<span class="Keyword">var</span> <span class="Identifier">f</span> <span class="Operator">=</span> <span class="Identifier">open</span><span class="Punctuation">(</span><span class="StringLit">&quot;numbers.txt&quot;</span><span class="Punctuation">)</span>
<span class="Keyword">try</span><span class="Punctuation">:</span>
  <span class="Identifier">f</span><span class="Operator">.</span><span class="Identifier">write</span> <span class="StringLit">&quot;abc&quot;</span>
  <span class="Identifier">f</span><span class="Operator">.</span><span class="Identifier">write</span> <span class="StringLit">&quot;def&quot;</span>
<span class="Keyword">finally</span><span class="Punctuation">:</span>
  <span class="Identifier">close</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">)</span></pre></p>

<h6 id="for的步数操作-0dotdot10用习惯了偶尔会忘记怎么使用ipluseq2步数的操作-可以自己写个iterator-但语言自带不用白不用dot">for的步数操作 0..10用习惯了偶尔会忘记怎么使用i+=2步数的操作, 可以自己写个iterator, 但语言自带不用白不用.</h6><p><pre class="listing">
<span class="Keyword">for</span> <span class="Identifier">i</span> <span class="Keyword">in</span> <span class="Identifier">countup</span><span class="Punctuation">(</span><span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="DecNumber">10</span><span class="Punctuation">,</span> <span class="DecNumber">2</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Comment">#降阶就是countdown</span>
   <span class="Identifier">echo</span> <span class="Identifier">i</span></pre></p>
<p>类似c的</p>
<p><pre class="listing">
<span class="Keyword">for</span><span class="Punctuation">(</span><span class="Keyword">int</span> <span class="Identifier">i</span><span class="Operator">=</span><span class="DecNumber">0</span><span class="Punctuation">;</span> <span class="Identifier">i</span><span class="Operator">&lt;=</span><span class="DecNumber">10</span> <span class="Identifier">i</span><span class="Operator">+=</span><span class="DecNumber">2</span><span class="Punctuation">)</span>
   <span class="Identifier">printf</span><span class="Punctuation">(</span><span class="StringLit">&quot;%d</span><span class="EscapeSequence">\n</span><span class="StringLit">&quot;</span><span class="Punctuation">,</span> <span class="Identifier">i</span><span class="Punctuation">)</span></pre></p>

<h6 id="ast辅助宏-dumptree宏可以用来辅助ast的使用dot">AST辅助宏 dumpTree宏可以用来辅助AST的使用.</h6><p><pre class="listing">
<span class="Identifier">dumpTree</span><span class="Punctuation">:</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;en!&quot;</span>
  <span class="Keyword">var</span> <span class="Identifier">x</span> <span class="Operator">=</span> <span class="DecNumber">100</span>
  <span class="Identifier">write</span><span class="Punctuation">(</span><span class="Identifier">stdout</span><span class="Punctuation">,</span> <span class="StringLit">&quot;x&quot;</span><span class="Punctuation">)</span>
  <span class="Identifier">writeln</span><span class="Punctuation">(</span><span class="Identifier">stdout</span><span class="Punctuation">,</span> <span class="Identifier">x</span><span class="Punctuation">)</span></pre></p>
<p><pre class="listing">
结果:
StmtList
  Command
    Ident !&quot;echo&quot;
    StrLit en!
  VarSection
    IdentDefs
      Ident !&quot;x&quot;
      Empty
      IntLit 100
  Call
    Ident !&quot;write&quot;
    Ident !&quot;stdout&quot;
    StrLit x
  Call
    Ident !&quot;writeln&quot;
    Ident !&quot;stdout&quot;
    Ident !&quot;x&quot;</pre></p>

<h6 id="from导入模块的同时制定别名-一般制定别名都是用">from导入模块的同时制定别名 一般制定别名都是用</h6><p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">xxx</span> <span class="Keyword">as</span> <span class="Identifier">x</span></pre></p>
<p>使用 from导入模块同样也可以制定别名哦, 这样不用写比较长的模块名了.</p>
<p><pre class="listing">
<span class="Keyword">from</span> <span class="Identifier">xxx</span> <span class="Keyword">as</span> <span class="Identifier">x</span> <span class="Keyword">import</span> <span class="Keyword">nil</span></pre></p>
<p>from导入模块的内容可以导入多个, 用逗号分隔.</p>
<p><pre class="listing">
<span class="Comment">#导入xxx里的x,y,z</span>
<span class="Keyword">from</span> <span class="Identifier">xxx</span> <span class="Keyword">import</span> <span class="Identifier">x</span><span class="Punctuation">,</span><span class="Identifier">y</span><span class="Punctuation">,</span><span class="Identifier">z</span></pre></p>

<h6 id="x64下编译x86程序">x64下编译x86程序</h6><p><pre class="listing">
nim c --cpu:i386 -t:-m32 -l:-m32 xxx.nim</pre> 如果不加后面的两个-m32就会弹错, 也许以后会改的容易些. ###### 快速得到文件,路径,后缀名</p>
<p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">os</span>
<span class="Keyword">var</span> <span class="Identifier">appname</span> <span class="Operator">=</span> <span class="Identifier">getAppFilename</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Keyword">var</span> <span class="Punctuation">(</span><span class="Identifier">dir</span><span class="Punctuation">,</span> <span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">ext</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">splitFile</span><span class="Punctuation">(</span><span class="Identifier">appname</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">dir</span><span class="Punctuation">,</span> <span class="StringLit">&quot;, &quot;</span><span class="Punctuation">,</span> <span class="Identifier">name</span><span class="Punctuation">,</span> <span class="StringLit">&quot;, &quot;</span><span class="Punctuation">,</span> <span class="Identifier">ext</span>
<span class="Comment"># c:\users\xxx, test, .exe</span>

<span class="Identifier">echo</span> <span class="Identifier">appname</span><span class="Operator">.</span><span class="Identifier">extractFilename</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Comment"># test.exe</span></pre></p>

<h6 id="把array当指针操作的正确姿势-当想把nim数组初始化时-会c的朋友肯定直接会把它memset-但nim里指针就是指针-得用ptrslashref得到才行dot-如真想当c的类型用可用cstring">把array当指针操作的正确姿势 当想把nim数组初始化时, 会c的朋友肯定直接会把它memset, 但nim里指针就是指针, 得用ptr/ref得到才行. (如真想当c的类型用可用cstring)</h6><p><pre class="listing">
<span class="Keyword">var</span> <span class="Identifier">inputs</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Keyword">ptr</span> <span class="Identifier">array</span><span class="Punctuation">[</span><span class="DecNumber">10</span><span class="Punctuation">,</span><span class="Identifier">int</span><span class="Punctuation">]</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">alloc0</span><span class="Punctuation">(</span><span class="Identifier">sizeof</span><span class="Punctuation">(</span><span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">*</span> <span class="DecNumber">10</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Identifier">inputs</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="DecNumber">99</span>
<span class="Identifier">echo</span> <span class="Identifier">repr</span> <span class="Identifier">inputs</span>
<span class="Comment">#echo cast[cstring](inputs)</span>
<span class="Identifier">dealloc</span><span class="Punctuation">(</span><span class="Identifier">inputs</span><span class="Punctuation">)</span>

<span class="Keyword">var</span> <span class="Identifier">test</span> <span class="Operator">=</span> <span class="Identifier">alloc0</span><span class="Punctuation">(</span><span class="DecNumber">10</span><span class="Punctuation">)</span>
<span class="Identifier">zeroMem</span><span class="Punctuation">(</span><span class="Identifier">test</span><span class="Punctuation">,</span> <span class="DecNumber">10</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">repr</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Keyword">ptr</span> <span class="Identifier">array</span><span class="Punctuation">[</span><span class="DecNumber">10</span><span class="Punctuation">,</span><span class="Identifier">char</span><span class="Punctuation">]</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">test</span><span class="Punctuation">)</span>
<span class="Comment">#echo cast[cstring](test)</span>
<span class="Identifier">dealloc</span><span class="Punctuation">(</span><span class="Identifier">test</span><span class="Punctuation">)</span></pre></p>
<p><pre class="listing">
ref 000000000018F050 --&gt; [99, 0, 0, 0, 0, 0, 0, 0, 0, 0]
ref 0000000000191050 --&gt; ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0']</pre> 如果没有ptr, 上面的数组就不是正确的地址, 而是指在错误的区域显示一堆乱数字, 所以不要用c的思想来看nim的类型变量.</p>



      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2023-05-28 20:29:30 UTC</small>
      </div>
    </div>
  </div>
  
</body>
</html>
